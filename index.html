<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Braze Web SDK SEL Sandbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="#" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7f9;
      padding: 40px;
      text-align: center;
    }
    .container {
      background: #ffffff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: inline-block;
      min-width: 320px;
    }
    button {
      width: 220px;
      margin: 10px auto;
      padding: 12px;
      cursor: pointer;
      background-color: #0073eb;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      font-size: 14px;
    }
    button:hover {
      background-color: #005bbd;
    }
    .status {
      margin-top: 15px;
      font-size: 13px;
      color: #555;
    }
  </style>

  <!-- Braze Web SDK Loader -->
  <script type="text/javascript">
    +function(a,p,P,b,y){
      a.braze={};a.brazeQueue=[];
      for(var s="initialize openSession changeUser logCustomEvent automaticallyShowInAppMessages getUser requestImmediateDataFlush toggleLogging".split(" "),i=0;i<s.length;i++){
        a.braze[s[i]]=function(){a.brazeQueue.push(arguments);}
      }
      (y=p.createElement(P)).type='text/javascript';
      y.src='https://js.appboycdn.com/web-sdk/6.5/braze.min.js';
      y.async=1;
      (b=p.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b);
    }(window,document,'script');
  </script>
</head>

<body>

  <div class="container">
    <h1>Braze SEL Sandbox</h1>
    <p class="status">Open DevTools Console to view SDK logs</p>

    <button onclick="startBraze()">1. Start Braze Session</button>
    <button onclick="loginUser()">2. Login & Identify User</button>
    <button onclick="triggerEvent()">3. Trigger Engagement (IAM)</button>
  </div>

  <script>
    let brazeInitialized = false;

    // 1. Initialize Braze SDK (ONLY ONCE)
    function startBraze() {
      if (brazeInitialized) {
        console.log("Braze already initialized");
        return;
      }

      braze.initialize("88884959-92fe-4bd7-ab6b-6660b1c9e859", {
        baseUrl: "sondheim.braze.com",
        enableLogging: true,
        allowUserSuppliedJavascript: true
      });

      braze.automaticallyShowInAppMessages();
      braze.openSession();
      braze.toggleLogging();

      brazeInitialized = true;

      console.log("Braze initialized and session started");
      alert("Braze initialized successfully");
    }

    // 2. Identify User via changeUser
    function loginUser() {
      if (!brazeInitialized) {
        alert("Initialize Braze first");
        return;
      }

      const userId = "SEL_TEST_" + Date.now();

      braze.changeUser(userId);
      braze.getUser().setFirstName("BrazeSEL");
      braze.getUser().setEmail(userId + "@example.com");
      braze.requestImmediateDataFlush();

      console.log("User identified as:", userId);
      alert("User logged in:\n" + userId);
    }

    // 3. Trigger In-App Message
    function triggerEvent() {
      if (!brazeInitialized) {
        alert("Initialize Braze first");
        return;
      }

      braze.logCustomEvent("web_sdk_test_event");
      braze.requestImmediateDataFlush();

      console.log("Custom event logged: web_sdk_test_event");
      alert("Event logged â€” IAM should appear now");
    }
  </script>

</body>
</html>
