<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Braze SEL Web SDK Sandbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--
    VISUAL STYLING (Braze-inspired)
    -------------------------------
    This styling is intentionally inspired by Braze's modern brand direction:
    soft gradients, warm accents, elevated cards, and clear call-to-action buttons.
    No official brand assets are used.
  -->
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", "Segoe UI", sans-serif;
      background: linear-gradient(
        135deg,
        #6f3cff 0%,
        #b84cff 40%,
        #ff8b5e 100%
      );
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1f2933;
    }

    .card {
      background: #ffffff;
      padding: 36px 32px;
      border-radius: 16px;
      width: 380px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      text-align: center;
    }

    h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 22px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 28px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      color: white;
      background: linear-gradient(
        135deg,
        #7b4dff,
        #ff8b5e
      );
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .log-hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 18px;
    }
  </style>

  <!--
    Braze Web SDK Loader (Async Queue)
    ---------------------------------
    This snippet queues Braze API calls until the SDK finishes loading.
    It allows us to safely call Braze methods before braze.min.js is ready.
  -->
  <script type="text/javascript">
    +function(a,p,P,b,y){
      a.braze={};
      a.brazeQueue=[];
      for(
        var s="initialize openSession changeUser logCustomEvent automaticallyShowInAppMessages getUser requestImmediateDataFlush toggleLogging isPushSupported requestPushPermission isPushPermissionGranted".split(" "),
        i=0;i<s.length;i++
      ){
        a.braze[s[i]]=function(){a.brazeQueue.push(arguments)}
      }
      (y=p.createElement(P)).type='text/javascript';
      y.src='https://js.appboycdn.com/web-sdk/6.5/braze.min.js';
      y.async=1;
      (b=p.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b)
    }(window,document,'script');
  </script>
</head>

<body>

  <div class="card">
    <h2>Braze SEL Sandbox</h2>
    <div class="subtitle">
      End-to-end Web SDK demo<br/>
      (Check DevTools Console)
    </div>

    <button onclick="startBraze()">1. Start Braze Session</button>
    <button onclick="loginUser()">2. Login & Identify User</button>
    <button onclick="triggerEvent()">3. Trigger Engagement (IAM)</button>
    <button onclick="enablePush()">4. Enable Web Push</button>

    <div class="log-hint">
      Open Console (F12) to view SDK logs
    </div>
  </div>

  <script>
    let isInitialized = false;

    // STEP 1: SDK INITIALIZATION
    function startBraze() {
      if (isInitialized) return;

      braze.initialize("88884959-92fe-4bd7-ab6b-6660b1c9e859", {
        baseUrl: "sondheim.braze.com",
        enableLogging: true,
        allowUserSuppliedJavascript: true,

        // Braze manages the service worker registration automatically
        manageServiceWorkerExternally: false,

        // Required for GitHub Pages since the app is not hosted at domain root
        serviceWorkerLocation: "/braze-web-sdk-sandbox/service-worker.js"
      });

      braze.automaticallyShowInAppMessages();
      braze.openSession();

      isInitialized = true;
      console.log("Braze initialized successfully");
    }

    // STEP 2: USER IDENTIFICATION
    function loginUser() {
      if (!isInitialized) return alert("Run Step 1 first!");

      const externalId = "SEL_TEST_" + Date.now();
      braze.changeUser(externalId);
      braze.getUser().setFirstName("BrazeSEL");
      braze.requestImmediateDataFlush();

      console.log("User identified:", externalId);
      alert("User logged in:\n" + externalId);
    }

    // STEP 3: IN-APP MESSAGE TRIGGER
    function triggerEvent() {
      if (!isInitialized) return alert("Run Step 1 first!");

      braze.logCustomEvent("web_sdk_test_event");
      braze.requestImmediateDataFlush();

      console.log("Custom event logged");
    }

    // STEP 4: WEB PUSH REGISTRATION
    function enablePush() {
      if (!isInitialized) return alert("Run Step 1 first!");

      if (braze.isPushSupported()) {
        braze.requestPushPermission(
          () => {
            setTimeout(() => {
              if (braze.isPushPermissionGranted()) {
                alert("Push enabled successfully!");
                braze.requestImmediateDataFlush();
              } else {
                alert("Permission granted, but registration failed.");
              }
            }, 2000);
          },
          err => console.error("Push error:", err)
        );
      } else {
        alert("Web Push is not supported in this browser.");
      }
    }
  </script>
</body>
</html>
